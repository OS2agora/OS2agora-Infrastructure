<VirtualHost *:*>
    RequestHeader set "X-Forwarded-Proto" expr=%{REQUEST_SCHEME}
</VirtualHost>

<VirtualHost *:${IN_INTERNAL_FE_PORT}>
	ServerName ${IN_INTERNAL_FE_HOST}

	<IfFile ${SSL_CERTIFICATE_FILE}>
		<IfFile ${SSL_CERTIFICATE_KEY_FILE}>
			SSLEngine on
			SSLCertificateFile ${SSL_CERTIFICATE_FILE}
			SSLCertificateKeyFile ${SSL_CERTIFICATE_KEY_FILE}
		</IfFile>
	</IfFile>

	ProxyPreserveHost On
	RequestHeader set x-api-key ${INTERNAL_FE_API_KEY}

	ProxyPass /api/ http://${OUT_API_HOST}:${OUT_API_PORT}/api/
	ProxyPassReverse /api/ http://${OUT_API_HOST}:${OUT_API_PORT}/api/

	ProxyPass / http://${OUT_INTERNAL_FE_HOST}:${OUT_INTERNAL_FE_PORT}/
	ProxyPassReverse / http://${OUT_INTERNAL_FE_HOST}:${OUT_INTERNAL_FE_PORT}/
	
	ErrorLog logs/agora-error.log
	CustomLog logs/agora-access.log common
</VirtualHost>

<VirtualHost *:${IN_PUBLIC_FE_PORT}>
	ServerName ${IN_PUBLIC_FE_HOST}

	<IfFile ${SSL_CERTIFICATE_FILE}>
		<IfFile ${SSL_CERTIFICATE_KEY_FILE}>
			SSLEngine on
			SSLCertificateFile ${SSL_CERTIFICATE_FILE}
			SSLCertificateKeyFile ${SSL_CERTIFICATE_KEY_FILE}
		</IfFile>
	</IfFile>

	ProxyPreserveHost On
	RequestHeader set x-api-key ${PUBLIC_FE_API_KEY}

	ProxyPass /api/ http://${OUT_API_HOST}:${OUT_API_PORT}/api/
	ProxyPassReverse /api/ http://${OUT_API_HOST}:${OUT_API_PORT}/api/

	ProxyPass / http://${OUT_PUBLIC_FE_HOST}:${OUT_PUBLIC_FE_PORT}/
	ProxyPassReverse / http://${OUT_PUBLIC_FE_HOST}:${OUT_PUBLIC_FE_PORT}/

	ErrorLog logs/agora-error.log
	CustomLog logs/agora-access.log common
</VirtualHost>
